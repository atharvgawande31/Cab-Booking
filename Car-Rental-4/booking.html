<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Complete Your Booking</title>
    <link rel="stylesheet" href="style.css" />
    <script src="carData.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      input[type="date"],
      input[type="time"],
      input[type="text"],
      input[type="email"],
      input[type="tel"],
      textarea {
        border: 1px solid hsl(var(--border));
        padding: 0.5rem 0.75rem;
        border-radius: 0.375rem;
        width: 100%;
        background-color: hsl(var(--background));
        color: hsl(var(--foreground));
      }
      input:focus,
      textarea:focus {
        border-color: hsl(var(--accent));
        box-shadow: 0 0 0 1px hsl(var(--accent));
        outline: none;
      }

      /* Utility */
      .sticky-top-6 {
        position: sticky;
        top: 1.5rem;
      }
    </style>
  </head>
  <body class="bg-background text-foreground">
    <div class="min-h-screen">
      <div class="bg-secondary/30 py-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex items-center space-x-2 text-sm mb-4">
            <a
              href="index.html"
              class="text-muted-foreground hover:text-foreground"
              >Home</a
            >
            <span class="text-muted-foreground">/</span>
            <a
              href="cars.html"
              class="text-muted-foreground hover:text-foreground"
              >Cars</a
            >
            <span class="text-muted-foreground">/</span>
            <span class="text-foreground font-medium">Booking</span>
          </div>
          <h1 class="text-3xl font-bold">Complete Your Booking</h1>
        </div>
      </div>

      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <a href="cars.html">
          <button
            class="mb-6 h-10 px-4 py-2 inline-flex items-center justify-center rounded-lg text-sm font-medium button-outline"
          >
            <i data-lucide="arrow-left" class="h-4 w-4 mr-2"></i>
            Back to Cars
          </button>
        </a>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <div class="lg:col-span-2">
            <form id="booking-form" class="space-y-6">
              <div class="card rounded-lg">
                <div class="p-6 space-y-4">
                  <div class="flex items-center pb-4 border-b border-border">
                    <i
                      data-lucide="calendar"
                      class="h-5 w-5 mr-2 text-accent"
                    ></i>
                    <h2 class="text-xl font-semibold">Rental Details</h2>
                  </div>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-2">
                      <label
                        for="pickup-location"
                        class="block text-sm font-medium"
                        >Pickup Location</label
                      >
                      <div class="relative">
                        <input
                          id="pickup-location"
                          type="text"
                          placeholder="Enter pickup location"
                          class="pl-10"
                          required
                        />
                      </div>
                    </div>
                    <div class="space-y-2">
                      <label
                        for="dropoff-location"
                        class="block text-sm font-medium"
                        >Dropoff Location</label
                      >
                      <div class="relative">
                        <input
                          id="dropoff-location"
                          type="text"
                          placeholder="Enter dropoff location"
                          class="pl-10"
                          required
                        />
                      </div>
                    </div>
                  </div>

                  <div
                    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"
                  >
                    <div class="space-y-2">
                      <label for="pickup-date" class="block text-sm font-medium"
                        >Pickup Date</label
                      >
                      <input id="pickup-date" type="date" required />
                    </div>
                    <div class="space-y-2">
                      <label for="pickup-time" class="block text-sm font-medium"
                        >Pickup Time</label
                      >
                      <input id="pickup-time" type="time" required />
                    </div>
                    <div class="space-y-2">
                      <label
                        for="dropoff-date"
                        class="block text-sm font-medium"
                        >Dropoff Date</label
                      >
                      <input id="dropoff-date" type="date" required />
                    </div>
                  </div>
                </div>
              </div>

              <div class="card rounded-lg">
                <div class="p-6 space-y-4">
                  <div class="flex items-center pb-4 border-b border-border">
                    <i data-lucide="users" class="h-5 w-5 mr-2 text-accent"></i>
                    <h2 class="text-xl font-semibold">Personal Information</h2>
                  </div>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-2">
                      <label for="first-name" class="block text-sm font-medium"
                        >First Name</label
                      >
                      <input
                        id="first-name"
                        type="text"
                        placeholder="Enter your first name"
                        required
                      />
                    </div>
                    <div class="space-y-2">
                      <label for="last-name" class="block text-sm font-medium"
                        >Last Name</label
                      >
                      <input
                        id="last-name"
                        type="text"
                        placeholder="Enter your last name"
                        required
                      />
                    </div>
                  </div>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-2">
                      <label for="email" class="block text-sm font-medium"
                        >Email Address</label
                      >
                      <input
                        id="email"
                        type="email"
                        placeholder="your.email@example.com"
                        required
                      />
                    </div>
                    <div class="space-y-2">
                      <label for="phone" class="block text-sm font-medium"
                        >Phone Number</label
                      >
                      <input
                        id="phone"
                        type="tel"
                        placeholder="+91 98765 43210"
                        required
                      />
                    </div>
                  </div>
                  <div class="space-y-2">
                    <label for="license" class="block text-sm font-medium"
                      >Driver's License Number</label
                    >
                    <input
                      id="license"
                      type="text"
                      placeholder="Enter your license number"
                      required
                    />
                  </div>
                </div>
              </div>

              <div class="card rounded-lg">
                <div class="p-6 space-y-4">
                  <h2 class="text-xl font-semibold pb-4 border-b border-border">
                    Insurance Coverage
                  </h2>
                  <div id="insurance-options-container" class="space-y-4"></div>
                </div>
              </div>

              <div class="card rounded-lg">
                <div class="p-6 space-y-4">
                  <h2 class="text-xl font-semibold pb-4 border-b border-border">
                    Special Requests (Optional)
                  </h2>
                  <textarea
                    id="special-requests"
                    placeholder="Any special requests or requirements..."
                    rows="3"
                  ></textarea>
                </div>
              </div>

              <button
                type="submit"
                id="proceed-button"
                class="w-full h-12 bg-gradient-primary text-white hover:opacity-90 text-lg font-semibold rounded-lg flex items-center justify-center "
               
              >
                <i data-lucide="credit-card" class="h-5 w-5 mr-2"></i>
              <a href="payment.html"> Proceed to Payment</a>
              </button>
            </form>
          </div>

          <div class="lg:col-span-1">
            <div class="card sticky-top-6 rounded-lg">
              <div class="p-6 space-y-6">
                <h2 class="text-xl font-semibold pb-4 border-b border-border">
                  Booking Summary
                </h2>
                <div id="summary-car-details" class="space-y-4"></div>

                <div class="separator"></div>

                <div id="summary-period" class="space-y-2"></div>

                <div class="separator"></div>

                <div id="summary-price" class="space-y-3"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="bg-[#0a2342] text-white py-10 mt-20">
        <div
          class="container mx-auto px-6 lg:px-20 grid grid-cols-1 md:grid-cols-4 gap-8"
        >
          <div>
            <h2 class="text-2xl font-bold">RentACar</h2>
            <p class="mt-3 text-gray-300 text-sm leading-relaxed">
              Your trusted car rental service for every journey. Safe, affordable,
              and reliable rides across India.
            </p>
          </div>
  
          <div>
            <h3 class="text-lg font-semibold mb-3">Quick Links</h3>
            <ul class="space-y-2 text-gray-300">
              <li>
                <a
                  href="index.html"
                  class="hover:text-white transition"
                  >Home</a
                >
              </li>
              <li>
                <a href="about.html" class="hover:text-white transition"
                  >About Us</a
                >
              </li>
              <li>
                <a
                  href="cars.html"
                  class="hover:text-white transition"
                  >Our Cars</a
                >
              </li>
              <li>
                <a
                  href="contact.html"
                  class="hover:text-white transition"
                  >Contact</a
                >
              </li>
            </ul>
          </div>
  
          <div>
            <h3 class="text-lg font-semibold mb-3">Support</h3>
            <ul class="space-y-2 text-gray-300">
     
              <li>
                <a
                  href="privacy.html"
                  class="hover:text-white transition"
                  >Booking Policy</a
                >
              </li>
              <li>
                <a
                  href="privacy.html"
                  class="hover:text-white transition"
                  >Terms & Conditions</a
                >
              </li>
              <li>
                <a
                  href="privacy.html"
                  class="hover:text-white transition"
                  >Privacy Policy</a
                >
              </li>
            </ul>
          </div>
  
          <div>
            <h3 class="text-lg font-semibold mb-3">Contact Us</h3>
            <p class="text-gray-300 text-sm">📍 Mumbai, India</p>
            <p class="text-gray-300 text-sm">📞 +91 98765 43210</p>
            <p class="text-gray-300 text-sm">✉️ support@rentacar.com</p>
          </div>
        </div>
  
        <div
          class="border-t border-gray-600 mt-10 pt-4 text-center text-gray-400 text-sm"
        >
          © 2025 RentACar. All rights reserved.
        </div>
      </footer>
    <script>
      // --- Data Definitions ---
      const MOCK_CAR_DATA = GLOBAL_CAR_DATA; // Assumes GLOBAL_CAR_DATA is loaded from carData.js

      const INSURANCE_OPTIONS = [
        {
          value: "basic",
          label: "Basic Coverage",
          price: 0,
          description: "Standard insurance included",
          pricePerDay: 0,
        },
        {
          value: "premium",
          label: "Premium Coverage",
          price: 25,
          description: "Enhanced protection with lower deductible",
          pricePerDay: 500,
        },
        {
          value: "comprehensive",
          label: "Comprehensive Coverage",
          price: 45,
          description: "Full coverage including theft and damage",
          pricePerDay: 900,
        },
      ];

      // --- State (Simulating React useState) ---
      const formData = {
        pickupLocation: "",
        dropoffLocation: "",
        pickupDate: "",
        pickupTime: "",
        dropoffDate: "",
        firstName: "",
        lastName: "",
        email: "",
        phone: "",
        licenseNumber: "",
        specialRequests: "",
        insuranceOption: "basic",
      };

      let selectedCar = null;
      let days = 1;

      // --- DOM Elements ---
      const formElement = document.getElementById("booking-form");
      const proceedButton = document.getElementById("proceed-button"); // Added button ref
      const insuranceContainer = document.getElementById(
        "insurance-options-container"
      );
      const summaryCarDetails = document.getElementById("summary-car-details");
      const summaryPeriod = document.getElementById("summary-period");
      const summaryPrice = document.getElementById("summary-price");

      // --- Helper Functions ---

      function getCarIdFromUrl() {
        const params = new URLSearchParams(window.location.search);
        const carId = params.get("car");
        return carId ? parseInt(carId) : MOCK_CAR_DATA[0].id; // Fallback to a default car
      }

      function findSelectedCar(carId) {
        return MOCK_CAR_DATA.find((c) => c.id === carId) || MOCK_CAR_DATA[0];
      }

      proceedButton.addEventListener("click" , () => {
        window.location.href = "payment.html"
      })
      /**
       * Calculates the rental duration in rounded-up days for pricing.
       */
      function calculateDays() {
        const pickupDateTimeStr =
          formData.pickupDate + "T" + (formData.pickupTime || "00:00");
        const dropoffDateTimeStr = formData.dropoffDate + "T" + "10:00";

        if (!formData.pickupDate || !formData.dropoffDate) return 1;

        const pickup = new Date(pickupDateTimeStr);
        const dropoff = new Date(dropoffDateTimeStr);

        const timeDiff = dropoff.getTime() - pickup.getTime();
        const durationHours = timeDiff / (1000 * 3600);

        if (durationHours <= 0) return 1;

        return Math.ceil(durationHours / 24);
      }

      /**
       * Converts total duration into a readable string (e.g., 2 Days & 3 Hours).
       */
      function getDurationString() {
        const pickupDateTimeStr =
          formData.pickupDate + "T" + (formData.pickupTime || "00:00");
        const dropoffDateTimeStr = formData.dropoffDate + "T" + "10:00";

        if (!formData.pickupDate || !formData.dropoffDate) return "1 Day";

        const pickup = new Date(pickupDateTimeStr);
        const dropoff = new Date(dropoffDateTimeStr);

        let timeDiff = dropoff.getTime() - pickup.getTime();

        if (timeDiff <= 0) return "1 Day (Min)";

        const msInDay = 1000 * 3600 * 24;
        const msInHour = 1000 * 3600;

        const totalDays = Math.floor(timeDiff / msInDay);
        timeDiff %= msInDay;

        const totalHours = Math.ceil(timeDiff / msInHour);

        if (totalDays > 0) {
          return `${totalDays} Day${totalDays > 1 ? "s" : ""}${
            totalHours > 0
              ? ` & ${totalHours} Hour${totalHours > 1 ? "s" : ""}`
              : ""
          }`;
        } else {
          return `${totalHours} Hour${totalHours > 1 ? "s" : ""}`;
        }
      }

      /**
       * Checks the validity of the essential form fields.
       * @returns {boolean} True if all key fields are filled and dates are valid.
       */
      function checkFormReadiness() {
        const rentalFields = [
          "pickupLocation",
          "dropoffLocation",
          "pickupDate",
          "pickupTime",
          "dropoffDate",
        ];
        const personalFields = [
          "firstName",
          "lastName",
          "email",
          "phone",
          "licenseNumber",
        ];

        const allRentalFilled = rentalFields.every((field) => formData[field]);
        const allPersonalFilled = personalFields.every(
          (field) => formData[field]
        );

        // Check custom date validity set by validateDatesAndTimes()
        const dateIsValid = formElement.checkValidity();

        return allRentalFilled && allPersonalFilled && dateIsValid;
      }

      function updateFormData(field, value) {
        formData[field] = value;

        // Validate dates/times on change
        if (field.includes("Date") || field.includes("Time")) {
          validateDatesAndTimes();
        }

        // Re-run summary on relevant changes
        if (
          [
            "pickupDate",
            "dropoffDate",
            "pickupTime",
            "insuranceOption",
          ].includes(field) ||
          field.includes("Location")
        ) {
          updateSummary();
        }

        // Update button state immediately
        proceedButton.disabled = !checkFormReadiness();
      }

      function validateDatesAndTimes() {
        const pickupDate = formData.pickupDate;
        const dropoffDate = formData.dropoffDate;
        const pickupTime = formData.pickupTime;
        const pickupTimeInput = document.getElementById("pickup-time");
        const dropoffDateInput = document.getElementById("dropoff-date");

        // 1. Minimum Date (Today or Future)
        const now = new Date();
        const pickupDateTime = new Date(
          pickupDate + "T" + (pickupTime || "00:00")
        );

        if (pickupTimeInput) {
          if (pickupDateTime.getTime() < now.getTime()) {
            pickupTimeInput.setCustomValidity(
              "Pickup must be a future date/time."
            );
          } else {
            pickupTimeInput.setCustomValidity("");
          }
        }

        // 2. Dropoff Date must be after Pickup Date/Time (using fixed 10:00 AM dropoff)
        if (dropoffDate && pickupDate) {
          const dropoffDateTime = new Date(dropoffDate + "T" + "10:00");
          if (dropoffDateTime.getTime() <= pickupDateTime.getTime()) {
            dropoffDateInput.setCustomValidity("Dropoff must be after Pickup.");
          } else {
            dropoffDateInput.setCustomValidity("");
          }
        }
      }

      function handleFormInput(e) {
        const input = e.target;
        let field = input.id || input.name;

        // Map inputs to form data fields
        const fieldMap = {
          "dropoff-location": "dropoffLocation",
          "pickup-location": "pickupLocation",
          "first-name": "firstName",
          "last-name": "lastName",
          email: "email",
          phone: "phone",
          license: "licenseNumber",
          "special-requests": "specialRequests",
          "pickup-date": "pickupDate",
          "dropoff-date": "dropoffDate",
          "pickup-time": "pickupTime",
        };

        const fieldName = fieldMap[field] || field;
        updateFormData(fieldName, input.value);
      }

      function handleInsuranceChange(value) {
        updateFormData("insuranceOption", value);
        renderInsuranceOptions();
      }

      // --- Rendering & Summary Update ---

      function renderCarDetailsSummary() {
        if (!selectedCar) return;
        const transmission = selectedCar.specs.transmission.includes("Manual")
          ? "Manual"
          : "Auto";
        const price = selectedCar.price.toLocaleString();

        summaryCarDetails.innerHTML = `
                <div class=" bg-gradient-card rounded-lg relative overflow-hidden">
                    <div class="absolute inset-0 bg-secondary/30 flex items-center justify-center">
                        <div class="text-center">
                            <i data-lucide="gauge" class="h-12 w-12 text-primary/50 mx-auto mb-2"></i>
                            <p class="text-sm text-muted-foreground">${selectedCar.name}</p>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 class="font-semibold text-lg">${selectedCar.name}</h3>
                    <p class="text-muted-foreground">${selectedCar.category} | ₹${price}/day</p>
                    <div class="flex items-center justify-between text-sm text-muted-foreground mt-2">
                        <div class="flex items-center space-x-1">
                            <i data-lucide="users" class="h-4 w-4"></i>
                            <span>${selectedCar.specs.passengers} Seats</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <i data-lucide="fuel" class="h-4 w-4"></i>
                            <span>${selectedCar.specs.fuel}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <i data-lucide="gauge" class="h-4 w-4"></i>
                            <span>${transmission}</span>
                        </div>
                    </div>
                </div>
            `;
        lucide.createIcons();
      }

      function renderInsuranceOptions() {
        insuranceContainer.innerHTML = INSURANCE_OPTIONS.map(
          (option) => `
                <div
                    class="p-4 border rounded-lg cursor-pointer transition-colors ${
                      formData.insuranceOption === option.value
                        ? "border-accent bg-accent/10"
                        : "border-border hover:border-accent/50"
                    }"
                    onclick="handleInsuranceChange('${option.value}')"
                >
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center space-x-2">
                            <input
                                type="radio"
                                name="insuranceOption"
                                class="h-4 w-4 text-accent border-accent focus:ring-accent"
                                value="${option.value}"
                                ${
                                  formData.insuranceOption === option.value
                                    ? "checked"
                                    : ""
                                }
                                onclick="event.stopPropagation(); handleInsuranceChange('${
                                  option.value
                                }')"
                            />
                            <span class="font-medium">${option.label}</span>
                        </div>
                        <span class="font-semibold text-accent">
                            ${
                              option.pricePerDay === 0
                                ? "Included"
                                : `+₹${option.pricePerDay}/day`
                            }
                        </span>
                    </div>
                    <p class="text-sm text-muted-foreground ml-6">${
                      option.description
                    }</p>
                </div>
            `
        ).join("");
      }

      function updateSummary() {
        // Recalculate duration and full days for pricing
        const durationString = getDurationString();
        const fullDaysForPricing = calculateDays();

        const selectedInsurance =
          INSURANCE_OPTIONS.find(
            (opt) => opt.value === formData.insuranceOption
          ) || INSURANCE_OPTIONS[0];
        const pricePerDay = selectedCar.price;

        // Calculations use the *rounded up* full days
        const subtotal = pricePerDay * fullDaysForPricing;
        const insuranceCostDaily = selectedInsurance.pricePerDay;
        const insuranceCostTotal = insuranceCostDaily * fullDaysForPricing;
        const taxes = (subtotal + insuranceCostTotal) * 0.15;
        const total = subtotal + insuranceCostTotal + taxes;

        // Date Formatting for Summary
        const formatDate = (dateString) => {
          if (!dateString) return "--";
          const date = new Date(dateString);
          return date.toLocaleDateString("en-IN", {
            day: "2-digit",
            month: "short",
          });
        };

        // Update Period Summary
        summaryPeriod.innerHTML = `
                <h4 class="font-medium">Rental Period</h4>
                <div class="text-sm space-y-1">
                    <div class="flex justify-between">
                        <span class="text-muted-foreground">Duration:</span>
                        <span>${durationString} (${fullDaysForPricing} day${
          fullDaysForPricing > 1 ? "s" : ""
        } charged)</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-muted-foreground">Pickup:</span>
                        <span>${formatDate(formData.pickupDate)} at ${
          formData.pickupTime || "00:00"
        }</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-muted-foreground">Dropoff:</span>
                        <span>${formatDate(
                          formData.dropoffDate
                        )} at 10:00</span>
                    </div>
                    <div class="flex justify-between pt-2">
                        <span class="text-muted-foreground">Location:</span>
                        <span>${formData.pickupLocation || "---"}</span>
                    </div>
                </div>
            `;

        // Update Price Breakdown
        summaryPrice.innerHTML = `
                <h4 class="font-medium">Price Breakdown</h4>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span>Car rental (${fullDaysForPricing} day${
          fullDaysForPricing > 1 ? "s" : ""
        })</span>
                        <span>₹${subtotal.toFixed(2)}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Insurance (${selectedInsurance.label})</span>
                        <span>+₹${insuranceCostTotal.toFixed(2)}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Taxes & Fees (15%)</span>
                        <span>+₹${taxes.toFixed(2)}</span>
                    </div>
                </div>
                
                <div class="separator"></div>
                
                <div class="flex justify-between text-lg font-semibold">
                    <span>Total</span>
                    <span class="text-accent">₹${total.toFixed(2)}</span>
                </div>
                <div class="text-xs text-muted-foreground">
                    *Price includes all applicable taxes and fees. No hidden charges.
                </div>
            `;
      }

      // --- Event Handlers ---

      function handleSubmit(e) {
        e.preventDefault();

        // Re-check validity after custom validation
        validateDatesAndTimes();

        // Check browser's native 'required' validity AND custom validity (set by validateDatesAndTimes)
        if (!e.target.checkValidity()) {
          // The browser will show error bubbles next to the invalid fields
          return;
        }

        // 3. Proceed to payment (Simulation)
        alert(
          "Booking details saved! Proceeding to Payment page. Total: ₹" +
            total.toFixed(2)
        );
        // In a real app: window.location.href = `payment_success.html?id=CF-456&car=${selectedCar.name}&total=${total.toFixed(2)}&date=${formData.pickupDate}`;
      }

      function setupEventListeners() {
        // Attach generic input handler to all input fields
        formElement.querySelectorAll("input, textarea").forEach((input) => {
          input.addEventListener("input", handleFormInput);
        });

        // Attach submit handler
        formElement.addEventListener("submit", handleSubmit);

        // Set min date for date inputs (ensuring future dates)
        const today = new Date();
        const todayString = today.toISOString().split("T")[0];
        document.getElementById("pickup-date").setAttribute("min", todayString);
        document
          .getElementById("dropoff-date")
          .setAttribute("min", todayString);
      }

      // --- Initialization (Handles Prefill from URL) ---
      document.addEventListener("DOMContentLoaded", () => {
        // 1. Get URL Parameters
        const params = new URLSearchParams(window.location.search);
        const carId = getCarIdFromUrl();

        // 2. Load Selected Car Data
        selectedCar = findSelectedCar(carId);

        // 3. Prefill Form Data and DOM inputs from URL parameters
        const urlData = {
          pickupLocation: params.get("pickupLocation"),
          dropoffLocation: params.get("dropoffLocation"),
          pickupDate: params.get("pickupDate"),
          pickupTime: params.get("pickupTime"),
          dropoffDate: params.get("dropoffDate"),
        };

        const inputFields = {
          "pickup-location": urlData.pickupLocation,
          "dropoff-location": urlData.dropoffLocation,
          "pickup-date": urlData.pickupDate,
          "pickup-time": urlData.pickupTime,
          "dropoff-date": urlData.dropoffDate,
        };

        for (const [id, value] of Object.entries(inputFields)) {
          const inputElement = document.getElementById(id);
          if (inputElement && value) {
            inputElement.value = value;

            // Manually update the formData state to reflect prefilled values
            let fieldName = id.replace(/-([a-z])/g, (g) => g[1].toUpperCase());
            updateFormData(fieldName, value);
          }
        }

        // 4. Render UI Components
        renderCarDetailsSummary();
        renderInsuranceOptions();
        updateSummary(); // Calculate initial price and render summary
        setupEventListeners();

        lucide.createIcons();

        // Set initial button state based on pre-filled data
        proceedButton.disabled = !checkFormReadiness();
      });
    </script>
  </body>
</html>
